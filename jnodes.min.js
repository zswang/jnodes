!function(e){function t(e){function t(t,i,o){if(!(o<=i)){var s={type:t,pos:i,endpos:o};return"text"!==t&&"comment"!==t||(s.value=e.slice(i,o)),r=o,n.push(s),s}}for(var n=[],r=0;r<e.length;){var i=e.slice(r).match(/([^\S\n]*)(?:<(!--)|<\/(:?[\w_]+[\w_-]*[\w_]|[\w_]+)\s*>|<(:?[\w_]+[\w_-]*[\w_]|[\w_]+)\s*)/);if(!i)break;t("text",r,r+i.index);var o=i[0].length,s=i[1];if(i[2]){if(i=e.slice(r+o).match(/-->/)){o+=i.index+i[0].length;var l=t("comment",r,r+o);l.indent=s}}else{var c=i[3];if(c){var u=t("right",r,r+o);u.tag=c,u.indent=s}else{c=i[4];for(var d=[];;){if(!(i=e.slice(r+o).match(/^\s*([:@]?[\w_]+[\w_-]*[\w_]|[\w_]+)\s*/)))break;o+=i[0].length;var f=i[1],h="",p="";switch(i=e.slice(r+o).match(/^\s*=\s*((')([^']*)'|(")([^"]*)"|([^'"\s\/>]+))\s*/),i&&(o+=i[0].length,h=i[1],p=i[2]||i[4]||""),p){case'"':case"'":h=h.slice(1,-1)}d.push({name:f,value:h,quoted:p})}if(!(i=e.slice(r+o).match(/^\s*(\/?)>/)))break;o+=i[0].length;var m=i[1]||a.indexOf(c)>=0,b=t(m?"single":"left",r,r+o);b.tag=c,b.attrs=d,b.indent=s,b.selfClosing=a.indexOf(c)>=0}}}return t("text",r,e.length),n}function n(e){var n={type:"root",pos:0,endpos:e.length,children:[]},i=n,o=t(e),s=[];return o.forEach(function(t){switch(t.type){case"comment":case"single":case"text":i.children.push(t),i.endpos=t.endpos;break;case"left":t.children=[],s.push(t),i.children.push(t),i=t;break;case"right":var o=void 0,a=void 0;if(s.length<=0)throw o=e.slice(0,t.endpos).split("\n"),o.length,o[o.length-1].length+1,r(o,5),a="No start tag. (line:"+t.line+" col:"+t.col+")",console.error(a),a;for(var l=s.length-1;l>=0;l--){var c=s[l],u=s[l-1];if(c.tag===t.tag){c.type="block",c.endpos=t.endpos,i=u||n,i.endpos=c.endpos,s=s.slice(0,l);break}if(!u)throw o=e.slice(0,t.endpos).split("\n"),o.length,o[o.length-1].length+1,r(o,5),a="No start tag. (line:"+t.line+" col:"+t.col+")",console.error(a),a;c.type="text",delete c.children,delete c.tag,delete c.attrs}}}),n}function r(e,t){for(var n=e.length.toString().length,r=e.slice(-t),i=r.length-1;i>=0;i--){var o=(e.length+i-r.length+1).toString();o=new Array(n-o.length+1).join(" ")+o,r[i]=o+(i===r.length-1?" > ":"   ")+"| "+r[i]}console.log(r.join("\n"))}function i(e,t,n){if(!e)return"";var r=e.indent||"";if(n&&n(e,t),e.overwriteNode)return e.overwriteNode;var o="";return e.beforebegin&&(o+=e.beforebegin),"text"===e.type||"comment"===e.type?o+=e.value:e.tag&&(o&&"\n"!==o[o.length-1]||(o+=r),o+="<"+e.tag,"string"==typeof e.overwriteAttrs?e.overwriteAttrs&&(o+=" "+e.overwriteAttrs):e.attrs.forEach(function(e){o+=" "+e.name,e.value&&(o+="="+e.quoted+e.value+e.quoted)}),"single"===e.type?(e.selfClosing||(o+="/"),o+=">"):o+=">"),e.selfClosing||"single"===e.type||(e.beforeend&&(o+=e.beforeend),e.children&&e.children.forEach(function(r){r.parent=e,o+=i(r,t,n)}),e.afterbegin&&(o+=e.afterbegin),e.tag&&("\n"===o[o.length-1]&&(o+=r),o+="</"+e.tag+">")),e.afterend&&(o+=e.afterend),o}var o=0,s=function(){function e(e){var t=this;e=e||{},this._binds={},this._templates={},this._bindObjectName=e.bindObjectName||"jnodes",this._bindAttributeName=e.bindAttributeName||"bind",this._scopeAttributeName=e.scopeAttributeName||"data-"+this._bindObjectName+"-scope",this._eventAttributePrefix=e.eventAttributePrefix||"data-"+this._bindObjectName+"-event-",this._onScopeCreate=e.onScopeCreate,this._onScopeDestroy=e.onScopeDestroy,this._templates={},this._compiler={},this._newScopes=[],this._findElement=e.findElement||function(e){return document.querySelector("["+e.scopeAttributeName+'="'+e.id+'"]')},this._updateElement=e.updateElement||function(e,n){if(e&&(n.outerRender||n.innerRender)){t.cleanChildren(n);var r=[];if(n.innerRender)if(n.outerRender){n.outerRender(r,!1);var i=r.join("");r=[],n.shell===i?(n.innerRender(r),e.innerHTML=r.join("")):(n.shell=i,n.outerRender(r,!0),e.outerHTML=r.join(""))}else n.innerRender(r),e.innerHTML=r.join("");else n.outerRender(r,!0),e.outerHTML=r.join("");t._onScopeCreate&&t._newScopes.forEach(function(e){t._onScopeCreate(e)}),t._newScopes=[]}},this._attrsRender=e.attrsRender||function(e,t){if(!t)return"";var n={},r={};return t.filter(function(t){if(":"!==t.name[0]&&"@"!==t.name[0])return!0;var i=t.name.slice(1),s=[];if(i===e.bindAttributeName?(i=e.scopeAttributeName,s.push(e.id)):e.eventAttributePrefix&&"@"===t.name[0]&&("create"!==i&&"destroy"!==i||(e.lifecycle=!0),i=e.eventAttributePrefix+i),n[i]=s,r[i]=t.quoted,i!==e.scopeAttributeName&&""!==t.value&&null!==t.value&&void 0!==t.value&&!1!==t.value)switch(typeof t.value){case"boolean":case"number":case"string":s.push(t.value);break;case"object":Object.keys(t.value).forEach(function(e){t.value[e]&&s.push(e)});break;case"function":var a="@"+(o++).toString(36);e.methods=e.methods||{},e.methods[a]=t.value,s.push(a)}}).forEach(function(e){var t=n[e.name]=n[e.name]||[];""===e.value||t.indexOf(e.value)>=0||t.push(e.value)}),Object.keys(n).map(function(e){var t=n[e];if(t.length<=0)return e;var i=r[e]||"";return e+"="+i+t.join(" ")+i}).join(" ")}}return e.prototype.registrTemplate=function(e,t){this._templates[e]=t},e.prototype.templateRender=function(e,t){var n=this._templates[e];if(n)return n(t)},e.prototype.templateCompiler=function(e,t){var n=this._compiler[e];if(n)return n(t,this._bindObjectName)},e.prototype.registrCompiler=function(e,t){this._compiler[e]=t},e.prototype.cleanChildren=function(e){var t=this;e.children&&e.children.forEach(function(n){var r=n.model&&n.model.$$binds;if(r){var i=r.indexOf(n);i>=0&&r.splice(i,1)}t._onScopeDestroy&&t._onScopeDestroy(n),delete t._binds[n.id],t.cleanChildren(n),e.children=[]})},e.prototype.bind=function(e,t,n,r){var i=this,s={model:e,parent:t,bindAttributeName:this._bindAttributeName,scopeAttributeName:this._scopeAttributeName,bindObjectName:this._bindObjectName,templateRender:this.templateRender,attrsRender:this._attrsRender,eventAttributePrefix:this._eventAttributePrefix};return this._newScopes.push(s),Object.defineProperty(s,"element",{enumerable:!0,configurable:!0,get:function(){return s._element},set:function(e){s._element=e,e&&(e.setAttribute(s.scopeAttributeName,s.id),i._onScopeCreate&&i._newScopes.forEach(function(e){i._onScopeCreate(e)}),i._newScopes=[])}}),n&&(s.outerRender=function(e,t){return n(e,s,t)}),r&&(s.innerRender=function(e){return r(e,s)}),e&&"object"==typeof e?(s.id=(o++).toString(36),this._binds[s.id]=s,t&&(t.children=t.children||[],t.children.push(s)),e.$$binds?e.$$binds.push(s):(e.$$binds=[s],observer(e,function(){e.$$binds.forEach(function(e){i.update(e)})},function(e){return e&&"$$"!==e.slice(2)}))):"string"==typeof e?(s.id=(o++).toString(36),this._binds[s.id]=s):s.id="value:"+e,s},e.prototype.element=function(e){return e._element||this._findElement(e)},e.prototype.update=function(e){delete e.methods,delete e.attrs,this._updateElement(this.element(e),e)},e.prototype.scope=function(e){var t;if("string"==typeof e){if(e.indexOf("value:")>=0)return{model:JSON.parse(e.slice(6))};if(t=this._binds[e])return t}else for(var n=e;n&&n.getAttribute;){var r=this.scope(n.getAttribute(this._scopeAttributeName));if(r)return r;n=n.parentNode}},e}(),a=["area","base","br","col","embed","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"],l={parse:n,build:i},c={Binder:s,observer:observer,Parser:l};"function"==typeof define?(define.amd||define.cmd)&&define(function(){return c}):"undefined"!=typeof module&&module.exports?module.exports=c:window.jnodes=c}();
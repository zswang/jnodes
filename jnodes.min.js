!function(e){function t(e,t,n){function r(r,i){if(!n||n(r)){var o=Object.getOwnPropertyDescriptor(e,r);if(!o||!1!==o.configurable){var a=o&&o.get,s=o&&o.set;Object.defineProperty(e,r,{enumerable:!0,configurable:!0,get:function(){return a?a.call(e):i},set:function(n){n!==(a?a.call(e):i)&&(s?s.call(e,n):i=n,t(e))}})}}}t&&(Array.isArray(e)?["push","pop","shift","unshift","splice","sort","reverse"].forEach(function(n){var r=e[n];Object.defineProperty(e,n,{value:function(){var n=r.apply(this,arguments);return t(e),n},enumerable:!1,writable:!0,configurable:!0})}):Object.keys(e).forEach(function(t){r(t,e[t])}))}function n(e){function t(t,i,o){if(!(o<=i)){var a={id:(c++).toString(36),type:t,pos:i,endpos:o};return"text"!==t&&"comment"!==t||(a.value=e.slice(i,o)),r=o,n.push(a),a}}for(var n=[],r=0;r<e.length;){var i=e.slice(r).match(/([^\S\n]*)(?:<(!--)|<\/(:?[\w_]+[\w_-]*[\w_]|[\w_]+)\s*>|<(:?[\w_]+[\w_-]*[\w_]|[\w_]+)\s*)/);if(!i)break;t("text",r,r+i.index);var o=i[0].length,a=i[1];if(i[2]){if(!(i=e.slice(r+o).match(/-->/))){t("comment",r,e.length).indent=a;break}o+=i.index+i[0].length;t("comment",r,r+o).indent=a}else{var l=i[3];if(l){var d=t("right",r,r+o);d.tag=l,d.indent=a}else{l=i[4];for(var u=[];;){if(!(i=e.slice(r+o).match(/^\s*([:@]?[\w_]+[\w_\-.]*[\w_]|[\w_]+)\s*/)))break;o+=i[0].length;var f=i[1],p="",h="";switch(i=e.slice(r+o).match(/^\s*=\s*((')([^']*)'|(")([^"]*)"|([^'"\s\/>]+))\s*/),i&&(o+=i[0].length,p=i[1],h=i[2]||i[4]||""),h){case'"':case"'":p=p.slice(1,-1)}u.push({name:f,value:p,quoted:h})}if(!(i=e.slice(r+o).match(/^\s*(\/?)>/)))break;o+=i[0].length;var v=i[1]||s.indexOf(l)>=0,m=t(v?"single":"left",r,r+o);m.tag=l,m.attrs=u,m.indent=a,m.selfClosing=s.indexOf(l)>=0}}}return t("text",r,e.length),n}function r(e){var t={id:(c++).toString(36),type:"root",pos:0,endpos:e.length,children:[]},r=t,i=n(e),o=[];return i.forEach(function(n){switch(n.type){case"comment":case"single":case"text":r.children.push(n),r.endpos=n.endpos;break;case"left":n.children=[],o.push(n),r.children.push(n),r=n;break;case"right":var i=void 0,a=void 0;if(o.length<=0)throw i=e.slice(0,n.endpos).split("\n"),i.length,i[i.length-1].length+1,a="No start tag. (line:"+n.line+" col:"+n.col+")",console.error(a),a;for(var s=o.length-1;s>=0;s--){var c=o[s],l=o[s-1];if(c.tag===n.tag){c.type="block",c.endpos=n.endpos,r=l||t,r.endpos=c.endpos,o=o.slice(0,s);break}if(!l)throw i=e.slice(0,n.endpos).split("\n"),i.length,i[i.length-1].length+1,a="No start tag. (line:"+n.line+" col:"+n.col+")",console.error(a),a;c.type="text",delete c.children,delete c.tag,delete c.attrs}}}),t}function i(e,t,n){if(!e)return"";var r=e.indent||"";if(n&&n(e,t),e.overwriteNode)return e.overwriteNode;var o="";return e.beforebegin&&(o+=e.beforebegin),"text"===e.type||"comment"===e.type?o+=e.value:e.tag&&(o&&"\n"!==o[o.length-1]||(o+=r),o+="<"+e.tag,"string"==typeof e.overwriteAttrs?e.overwriteAttrs&&(o+=" "+e.overwriteAttrs):e.attrs.forEach(function(e){o+=" "+e.name,e.value&&(o+="="+e.quoted+e.value+e.quoted)}),"single"===e.type?(e.selfClosing||(o+="/"),o+=">"):o+=">"),e.selfClosing||"single"===e.type||(e.beforeend&&(o+=e.beforeend),e.children&&e.children.forEach(function(r){r.parent=e,o+=i(r,t,n)}),e.afterbegin&&(o+=e.afterbegin),e.tag&&("\n"===o[o.length-1]&&(o+=r),o+="</"+e.tag+">")),e.afterend&&(o+=e.afterend),o}var o=0,a=function(){function e(e){var t=this;this._adapters={},e=e||{},this._binds={},this._templates={},this._adapters={},this._bindObjectName=e.bindObjectName||"jnodes.binder",this._bindAttributeName=e.bindAttributeName||"bind",this._dependAttributeName=e.dependAttributeName||"depend",this._scopeAttributeName=e.scopeAttributeName||"data-jnodes-scope",this._eventAttributePrefix=e.eventAttributePrefix||"data-jnodes-event-",this._imports=e.imports,this._templates={},this._checkers={},this._findElement=e.findElement||function(e){return document.querySelector("["+t._scopeAttributeName+'="'+e.id+'"]')},this._updateElement=e.updateElement||function(e,n){if(e&&(n.outerRender||n.innerRender)){t.lifecycleEvent(n,"destroy"),t.cleanChildren(n);var r=[];if(n.innerRender)if(n.outerRender){n.outerRender(r,!1);var i=r.join("");r=[],n.shell===i?(n.innerRender(r),e.innerHTML=r.join("")):(n.shell=i,n.outerRender(r,!0),e.outerHTML=r.join(""))}else n.innerRender(r),e.innerHTML=r.join("");else n.outerRender(r,!0),e.outerHTML=r.join("");t.lifecycleEvent(n,"create"),t.lifecycleEvent(n,"update")}},this._attrsRender=e.attrsRender||function(e,n,r){if(!n)return"";var i={},a={},s=!1;return n.filter(function(n){if(":"!==n.name[0]&&"@"!==n.name[0])return!0;var r=n.name.slice(1);if(r!==t._bindAttributeName&&r!==t._dependAttributeName)return!0;r=t._scopeAttributeName,a[r]=n.quoted,i[r]=[e.id],s=!0,e.methods=e.methods||{},Object.keys(e.methods).forEach(function(t){"function"==typeof e.methods[t]&&(e.methods[t].$$scope||delete e.methods[t])})}).filter(function(n){if(":"!==n.name[0]&&"@"!==n.name[0])return!0;var r=n.name.slice(1);if("@"===n.name[0]){r=r.split(".")[0],"create"===r?e.lifecycleCreate=!0:"destroy"===r?e.lifecycleDestroy=!0:"update"===r&&(e.lifecycleUpdate=!0),r=t._eventAttributePrefix+r}var c=i[r]=i[r]||[];if(a[r]=n.quoted,""!==n.value&&null!==n.value&&void 0!==n.value&&!1!==n.value)switch(typeof n.value){case"boolean":case"number":case"string":c.push(n.value);break;case"object":Object.keys(n.value).forEach(function(e){n.value[e]&&c.push(e)});break;case"function":e.methods=e.methods||{};var l=void 0;s&&(l=e.methods["v:"+n.value]),l||(l="@"+(o++).toString(36),e.methods[l]=n.value,s&&(n.value.$$scope=e,e.methods["v:"+n.value]=l)),c.push(l)}}).forEach(function(e){var t=i[e.name]=i[e.name]||[];a[e.name]=e.quoted,""===e.value||t.indexOf(e.value)>=0||t.push(e.value)}),Object.keys(i).map(function(e){var t=i[e];if(t.length<=0)return null;var n=a[e]||"";return 1===t.length&&!0===t[0]?""+e:e+"="+n+t.join(" ")+n}).join(" ")}}return e.prototype.registerTemplate=function(e,t){this._templates[e]=t},e.prototype.templateRender=function(e,t){var n=this._templates[e];if(n)return n(t)},e.prototype.registerChecker=function(e,t){this._checkers[e]=t},e.prototype.eventChecker=function(e,t){var n=this._checkers[e.type];if(n)return n(e,t)},e.prototype.templateAdapter=function(e,t){var n=this._adapters[e];if(n)return n(t,this._bindObjectName)},e.prototype.registerAdapter=function(e,t){this._adapters[e]=t},e.prototype.cleanChildren=function(e){var t=this;e.children&&e.children.forEach(function(n){var r=n.model&&n.model.$$binds&&n.model.$$binds();if(r){var i=r.indexOf(n);i>=0&&r.splice(i,1)}delete t._binds[n.id],t.cleanChildren(n),e.children=[],delete e.methods,delete e.attrs})},e.prototype.lifecycleEvent=function(e,t){function n(e){return"update"!==t?!!("create"===t&&e.lifecycleCreate||"destroy"===t&&e.lifecycleDestroy)||(e.children?e.children.some(n):void 0):!!e.lifecycleUpdate||void 0}var r=this;if(n(e)){var i=this.element(e);if("update"===t)this.triggerScopeEvent({type:t,target:i});else{[].slice.apply(i.querySelectorAll("["+this._eventAttributePrefix+t+"]")).forEach(function(e){r.triggerScopeEvent({type:t,target:e}),e.removeAttribute(""+r._eventAttributePrefix+t)})}}},e.prototype.bind=function(e,t,n,r){var i=this,a={type:"bind",model:e,parent:t,binder:this};return Object.defineProperty(a,"element",{enumerable:!0,configurable:!0,get:function(){return a._element},set:function(e){a._element=e,e&&(e.setAttribute(i._scopeAttributeName,a.id),i.lifecycleEvent(a,"create"))}}),n&&(a.outerRender=function(e,t){return n(e,a,t)}),r&&(a.innerRender=function(e){return r(e,a)}),a.id=(o++).toString(36),this._binds[a.id]=a,this.observer(e,a),a},e.prototype.observer=function(e,n){function r(e,t){var n=t.parent;n.model.$$binds&&n.model.$$binds().forEach(function(t){"depend"!==t.type?e.indexOf(t)<0&&e.push(t):r(e,t)})}var i=n.parent;if(i&&(i.children=i.children||[],i.children.push(n)),e&&"object"==typeof e)if(e.$$binds)e.$$binds().push(n);else{var o=[n];e.$$binds=function(){return o},t(e,function(){var t=[];e.$$binds().forEach(function(e){"depend"!==e.type?e.binder.update(e):r(t,e)}),t.forEach(function(e){e.binder.update(e)})},function(e){return e&&"$$"!==e.slice(2)})}},e.prototype.depend=function(e,t,n){var r={type:"depend",model:e,parent:t,binder:this,outerRender:function(e){return n(e,r,!0)}};return this.observer(e,r),r.id=(o++).toString(36),this._binds[r.id]=r,r},e.prototype.element=function(e){return e._element||this._findElement(e)},e.prototype.update=function(e){e&&this._updateElement(this.element(e),e)},e.prototype.scope=function(e){var t;if("string"==typeof e){if(t=this._binds[e])return t}else for(var n=e;n&&n.getAttribute;){var r=this.scope(n.getAttribute(this._scopeAttributeName));if(r)return r;n=n.parentNode}},e.prototype.triggerScopeEvent=function(e,t){if(t=t||e.target){var n=t.getAttribute(this._eventAttributePrefix+e.type);if(n&&"@"===n[0]){var r=this.scope(t);if(!r)return;n.replace(/@\w+/g,function(n){var i=(r.methods||{})[n];return i&&i.call(t,e),""})}}},e}(),s=["area","base","br","col","embed","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"],c=0,l={parse:r,build:i},d={Binder:a,observer:t,Parser:l};"function"==typeof define?(define.amd||define.cmd)&&define(function(){return d}):"undefined"!=typeof module&&module.exports?module.exports=d:window.jnodes=d}();